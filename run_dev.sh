#!/bin/bash

# Sultan Prints Development Server Script
# ุณูุฑูุจุช ุชุดุบูู ุฎุงุฏู ุงูุชุทููุฑ ููุชุฌุฑ ุณูุทุงู ุจุฑููุชุณ

echo "๐ ุจุฏุก ุชุดุบูู ูุชุฌุฑ ุณูุทุงู ุจุฑููุชุณ..."

# ุงูุชุญูู ูู ูุฌูุฏ ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ
if [ ! -d "venv" ]; then
    echo "โ ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ ุบูุฑ ููุฌูุฏุฉ. ูุชู ุฅูุดุงุคูุง..."
    python3 -m venv venv
fi

# ุชูุนูู ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ
echo "๐ฆ ุชูุนูู ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ..."
source venv/bin/activate

# ุชุซุจูุช ุงููุชุทูุจุงุช
echo "๐ฅ ุชุซุจูุช ุงููุชุทูุจุงุช..."
pip install -r requirements.txt

# ุงูุชุญูู ูู ูุฌูุฏ ููู .env
if [ ! -f ".env" ]; then
    echo "โ๏ธ ููู .env ุบูุฑ ููุฌูุฏ. ูุชู ุฅูุดุงุคู..."
    cp .env-example .env
    echo "โ ุชู ุฅูุดุงุก ููู .env. ูุฑุฌู ุชุนุฏููู ุญุณุจ ุฅุนุฏุงุฏุงุชู."
fi

# ุฅูุดุงุก ุงููุฌูุฏุงุช ุงููุทููุจุฉ
echo "๐ ุฅูุดุงุก ุงููุฌูุฏุงุช ุงููุทููุจุฉ..."
mkdir -p static/uploads/custom static/uploads/designs static/uploads/products logs

# ุงูุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
echo "๐๏ธ ุงูุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช..."
if command -v mysql >/dev/null 2>&1; then
    if mysql -u root -e "USE sultan_prints" 2>/dev/null; then
        echo "โ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุชุงุญุฉ"
    else
        echo "โ๏ธ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุบูุฑ ููุฌูุฏุฉ. ูุฑุฌู ุงูุชุฃูุฏ ูู ุชุดุบูู XAMPP ูุฅูุดุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช."
    fi
else
    echo "โ๏ธ MySQL ุบูุฑ ูุชุงุญ. ูุฑุฌู ุงูุชุฃูุฏ ูู ุชุดุบูู XAMPP."
fi

# ุชุดุบูู ุงูุชุฑุญููุงุช
echo "๐ ุชุดุบูู ุชุฑุญููุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช..."
flask db upgrade

# ุชุดุบูู ุงูุณูุฑูุฑ
echo "๐ ุชุดุบูู ุฎุงุฏู ุงูุชุทููุฑ..."
echo "๐ ุงูุนููุงู: http://localhost:8000"
echo "๐ง ููุญุฉ ุงูุชุญูู: http://localhost:8000/admin"
echo "๐ง ุงูุจุฑูุฏ: admin@tshirtshop.com"
echo "๐ ูููุฉ ุงููุฑูุฑ: superadmin123"
echo ""
echo "ุงุถุบุท Ctrl+C ูุฅููุงู ุงูุฎุงุฏู"

# ุชุดุบูู Flask ุนูู ุงููููุฐ 8000
FLASK_ENV=development flask run --host=0.0.0.0 --port=8000 